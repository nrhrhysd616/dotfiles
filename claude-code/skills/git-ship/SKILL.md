# git-ship

実装完了後の一連のGit操作（ブランチ確認・作成、add、commit、push、PR作成）を各ステップのユーザー確認を挟みながらまとめて実行するスキル。

## 起動方法

`/git-ship [コミットメッセージのヒント]`

例: `/git-ship add user authentication feature`

## 引数

- `$ARGUMENTS`: コミットメッセージ・ブランチ名生成のヒント（任意）

## 実行フロー

以下の7フェーズを順に実行する。各フェーズでユーザーの確認を得てから次へ進むこと。

---

### Phase 1: 変更内容の確認

1. `git status` で変更ファイルの一覧を表示する
2. `git diff` で変更の詳細を確認する
3. 変更内容のサマリーをユーザーに提示する
4. 処理を続けるか確認し、ユーザーの承認を得る

---

### Phase 2: ブランチの確認・作成

1. `git branch --show-current` で現在のブランチ名を確認する
2. ブランチ名が `yyyyMMdd/<task-name>` 形式（例: `20260219/add-git-ship-skill`）に適合しているか判断する
3. 適合している場合:
   - 現在のブランチ名を表示し、そのまま使用するかユーザーに確認する
4. 適合していない場合（`main`、`develop`、`feature/xxx` など）:
   - 変更内容と `$ARGUMENTS` から適切な `<task-name>` を生成し、ブランチ名（`yyyyMMdd/<task-name>`）を提案する
   - ユーザーが確認・修正し承認したら `git checkout -b <branch-name>` を実行する

---

### Phase 3: コミットメッセージの決定

1. 変更内容と `$ARGUMENTS` のヒントをもとに Conventional Commits 形式でコミットメッセージを生成する
   - 形式: `<type>(<scope>): <subject>`
   - type: `feat` / `fix` / `docs` / `style` / `refactor` / `perf` / `test` / `chore`
2. 生成したメッセージをユーザーに提示し、確認・修正を求める
3. ユーザーが承認したら次へ進む

---

### Phase 4: git add

1. ステージングするファイルの一覧を表示してユーザーに確認する
   - `.env`、秘密鍵、APIキー等のセンシティブなファイルが含まれていた場合は **警告して処理を中断する**
2. 承認されたら `git add <files>` を個別指定で実行する（`git add .` は使用しない）
3. `git status` で結果を確認・表示する

---

### Phase 5: git commit

1. 確定したコミットメッセージを表示してユーザーに最終確認する
2. 承認されたら以下の形式で `git commit` を実行する:

   ```
   git commit -m "$(cat <<'EOF'
   <確定したコミットメッセージ>

   Co-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>
   EOF
   )"
   ```

---

### Phase 6: git push

1. プッシュ先（`origin/<現在のブランチ>`）を表示してユーザーに確認する
2. 承認されたら `git push -u origin <branch>` を実行する（`-u` で上流ブランチを設定する）

---

### Phase 7: PR作成

1. ベースブランチを決定する:
   - `git branch -r` でリモートブランチを確認する
   - `origin/develop` が存在すれば `develop` をデフォルトとしてユーザーに提示する
   - `origin/develop` が存在しなければ `main` をデフォルトとしてユーザーに提示する
   - ユーザーが確認・変更できる
2. コミット内容からPRのタイトルとボディを生成する:
   - タイトル: 70文字以内
   - ボディ: `## Summary`（箇条書き1〜3点）と `## Test plan`（テスト手順のチェックリスト）を含める
3. 生成したPR情報をユーザーに提示し、確認・修正を求める
4. `gh` コマンドが未インストールの場合は警告して処理を中断する
5. 承認されたら `gh pr create` を実行する
6. 作成されたPRのURLをユーザーに提示して完了

---

## 注意事項

- `git add .` は使用しない。変更ファイルを個別に確認・追加してセンシティブファイルの誤コミットを防ぐこと
- `.env`、秘密鍵、APIキーが含まれていた場合は即座に処理を中断してユーザーに警告すること
- `gh` コマンド（GitHub CLI）が必要。未インストールの場合はPR作成ステップで警告すること
- 各フェーズの完了をユーザーに報告してから次へ進むこと
