# git-ship

実装完了後の一連のGit操作（ブランチ確認・作成、add、commit、push、PR作成）を各ステップのユーザー確認を挟みながらまとめて実行するスキル。

## 起動方法

`/git-ship [コミットメッセージのヒント]`

例: `/git-ship add user authentication feature`

## 引数

- `$ARGUMENTS`: コミットメッセージ・ブランチ名生成のヒント（任意）

## 実行フロー

以下の7フェーズを順に実行する。**新規ブランチ名の決定時のみユーザーの確認を得る。それ以外は自動で次へ進む。**

---

### Phase 1: 変更内容の確認

1. `git status` で変更ファイルの一覧を表示する
2. `git diff` で変更の詳細を確認する
3. 変更内容のサマリーをユーザーに提示する
4. **確認不要** — スキルを起動した時点で続行の意思表示とみなし、自動で次へ進む

---

### Phase 2: ブランチの確認・作成

1. `git branch --show-current` で現在のブランチ名を確認する
2. 現在のブランチ名が`develop`ブランチではない場合、`develop`ブランチに切り替える
3. ブランチ名が `yyyyMMdd/<task-name>` 形式（例: `20260219/add-git-ship-skill`）に適合しているか判断する
4. 適合している場合:
   - **確認不要** — 現在のブランチ名をそのまま使用して自動で次へ進む
5. 適合していない場合（`main`、`develop`、`feature/xxx` など）:
   - 変更内容と `$ARGUMENTS` から適切な `<task-name>` を生成し、ブランチ名（`yyyyMMdd/<task-name>`）を提案する
   - **確認必要** — ユーザーが確認・修正し承認したら `git checkout -b <branch-name>` を実行する

---

### Phase 3: コミットメッセージの決定

1. 変更内容と `$ARGUMENTS` のヒントをもとに Conventional Commits 形式でコミットメッセージを生成する
   - 形式: `<type>(<scope>): <subject>`
   - type: `feat` / `fix` / `docs` / `style` / `refactor` / `perf` / `test` / `chore`
2. **確認不要** — 生成したメッセージをユーザーに提示し、自動で次へ進む

---

### Phase 4: git add

1. ステージングするファイルの一覧を表示する
   - `.env`、秘密鍵、APIキー等のセンシティブなファイルが含まれていた場合は **警告して処理を中断する**
2. **確認不要** — センシティブファイルがなければ `git add <files>` を個別指定で自動実行する（`git add .` は使用しない）
3. `git status` で結果を確認・表示する

---

### Phase 5: git commit

1. 確定したコミットメッセージを表示する
2. **確認不要** — 以下の形式で `git commit` を自動実行する:

   ```
   git commit -m "$(cat <<'EOF'
   <確定したコミットメッセージ>

   Co-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>
   EOF
   )"
   ```

---

### Phase 6: git push

1. プッシュ先（`origin/<現在のブランチ>`）を表示する
2. **確認不要** — `git push -u origin <branch>` を自動実行する（`-u` で上流ブランチを設定する）

---

### Phase 7: PR作成

1. ベースブランチを決定する:
   - `git branch -r` でリモートブランチを確認する
   - `origin/develop` が存在すれば `develop` を使用する
   - `origin/develop` が存在しなければ `main` を使用する
2. コミット内容からPRのタイトルとボディを生成する:
   - タイトル: 70文字以内
   - ボディ: `## Summary`（箇条書き1〜3点）と `## Test plan`（テスト手順のチェックリスト）を含める
3. **確認不要** — 生成したPR情報をユーザーに提示して `gh pr create` を自動実行する
4. `gh` コマンドが未インストールの場合は警告して処理を中断する
5. 作成されたPRのURLをユーザーに提示して完了

---

## 注意事項

- `git add .` は使用しない。変更ファイルを個別に確認・追加してセンシティブファイルの誤コミットを防ぐこと
- `.env`、秘密鍵、APIキーが含まれていた場合は即座に処理を中断してユーザーに警告すること
- `gh` コマンド（GitHub CLI）が必要。未インストールの場合はPR作成ステップで警告すること
- 各フェーズの完了をユーザーに報告してから次へ進むこと
- **ユーザー確認が必要なのは「新規ブランチ名の決定」のみ**
